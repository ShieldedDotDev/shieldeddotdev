define("shielded",[],(function(){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=3)}([function(t,e,n){var r,i=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function u(t){try{s(r.next(t))}catch(t){o(t)}}function a(t){try{s(r.throw(t))}catch(t){o(t)}}function s(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(u,a)}s((r=r.apply(t,e||[])).next())}))},o=this&&this.__generator||function(t,e){var n,r,i,o,u={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;u;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return u.label++,{value:o[1],done:!1};case 5:u.label++,r=o[1],o=[0];continue;case 7:o=u.ops.pop(),u.trys.pop();continue;default:if(!(i=(i=u.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){u=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){u.label=o[1];break}if(6===o[0]&&u.label<i[1]){u.label=i[1],i=o;break}if(i&&u.label<i[2]){u.label=i[2],u.ops.push(o);break}i[2]&&u.ops.pop(),u.trys.pop();continue}o=e.call(t,u)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};void 0===(r=function(t,e){"use strict";function n(t,e,n,r){void 0===e&&(e="GET"),void 0===n&&(n=null),void 0===r&&(r=function(){});var i=new XMLHttpRequest;return i.open(e,"/"+t,!0),r(i),new Promise((function(t,e){i.addEventListener("load",(function(n){this.status>=200&&this.status<400?t(this.responseText):e({ctx:this,event:n})})),i.withCredentials=!0,i.addEventListener("error",(function(t){e({ctx:this,event:t})})),n?i.send(n):i.send()}))}e.__esModule=!0,e.doRequest=function(t,e,r,u){return void 0===e&&(e="GET"),void 0===r&&(r=null),void 0===u&&(u=function(){}),i(this,void 0,void 0,(function(){var i;return o(this,(function(o){switch(o.label){case 0:return[4,n(t,e,r,u)];case 1:return i=o.sent(),[2,new Promise((function(t){t(JSON.parse(i))}))]}}))}))},e.doRawRequest=n}.apply(e,[n,e]))||(t.exports=r)},function(t,e,n){var r;void 0===(r=function(t,e){"use strict";e.__esModule=!0;var n=function(){function t(t,e){this.container=t,this.name=e,this.container.classList.add(this.name+"--controller")}return t.prototype.attach=function(t){t.appendChild(this.container)},t.prototype.detach=function(t){try{t.removeChild(this.container)}catch(t){return!1}return!0},t.prototype.getContainer=function(){return this.container},t.prototype.getName=function(){return this.name},t}();e.AbstractBaseController=n}.apply(e,[n,e]))||(t.exports=r)},function(t,e,n){var r;void 0===(r=function(t,e){"use strict";e.__esModule=!0;var n=function(){function t(){this.listeners=new Set}return t.prototype.add=function(t){this.listeners.add(t)},t.prototype.trigger=function(t){this.listeners.forEach((function(e){return e(t)}))},t}();e.EventEmitter=n}.apply(e,[n,e]))||(t.exports=r)},function(t,e,n){var r,i;r=[n,e,n(4)],void 0===(i=function(t,e,n){"use strict";e.__esModule=!0,function(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}(n)}.apply(e,r))||(t.exports=i)},function(t,e,n){var r,i,o=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function u(t){try{s(r.next(t))}catch(t){o(t)}}function a(t){try{s(r.throw(t))}catch(t){o(t)}}function s(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(u,a)}s((r=r.apply(t,e||[])).next())}))},u=this&&this.__generator||function(t,e){var n,r,i,o,u={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;u;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return u.label++,{value:o[1],done:!1};case 5:u.label++,r=o[1],o=[0];continue;case 7:o=u.ops.pop(),u.trys.pop();continue;default:if(!(i=(i=u.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){u=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){u.label=o[1];break}if(6===o[0]&&u.label<i[1]){u.label=i[1],i=o;break}if(i&&u.label<i[2]){u.label=i[2],u.ops.push(o);break}i[2]&&u.ops.pop(),u.trys.pop();continue}o=e.call(t,u)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};r=[n,e,n(5),n(6),n(7),n(9)],void 0===(i=function(t,e,n,r,i,a){"use strict";e.__esModule=!0,e.Dashboard=function(t){return o(this,void 0,void 0,(function(){var e,o,s;return u(this,(function(u){switch(u.label){case 0:return[4,(new n.AuthedApi).isAuthed()];case 1:return u.sent()||(window.location.href="/"),e=new r.ShieldsApi,o=new a.ShieldsModel(e),(s=new i.DashboardController(o)).attach(t),o.shieldEventEmitter.add((function(){s.render()})),[2]}}))}))}}.apply(e,r))||(t.exports=i)},function(t,e,n){var r,i,o=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function u(t){try{s(r.next(t))}catch(t){o(t)}}function a(t){try{s(r.throw(t))}catch(t){o(t)}}function s(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(u,a)}s((r=r.apply(t,e||[])).next())}))},u=this&&this.__generator||function(t,e){var n,r,i,o,u={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;u;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return u.label++,{value:o[1],done:!1};case 5:u.label++,r=o[1],o=[0];continue;case 7:o=u.ops.pop(),u.trys.pop();continue;default:if(!(i=(i=u.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){u=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){u.label=o[1];break}if(6===o[0]&&u.label<i[1]){u.label=i[1],i=o;break}if(i&&u.label<i[2]){u.label=i[2],u.ops.push(o);break}i[2]&&u.ops.pop(),u.trys.pop();continue}o=e.call(t,u)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};r=[n,e,n(0)],void 0===(i=function(t,e,n){"use strict";e.__esModule=!0;var r=function(){function t(){}return t.prototype.isAuthed=function(){return o(this,void 0,void 0,(function(){return u(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,n.doRequest("api/authed","GET",null)];case 1:return t.sent(),[2,!0];case 2:return t.sent(),[2,!1];case 3:return[2]}}))}))},t}();e.AuthedApi=r}.apply(e,r))||(t.exports=i)},function(t,e,n){var r,i;r=[n,e,n(0)],void 0===(i=function(t,e,n){"use strict";e.__esModule=!0;var r=function(){function t(){}return t.prototype.getShields=function(){return n.doRequest("api/shields","GET",null)},t.prototype.saveShield=function(t){return t.ShieldID?n.doRequest("api/shield/"+t.ShieldID,"PUT",JSON.stringify(t)):n.doRequest("api/shields","POST",JSON.stringify(t))},t}();e.ShieldsApi=r}.apply(e,r))||(t.exports=i)},function(t,e,n){var r,i,o,u=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),a=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function u(t){try{s(r.next(t))}catch(t){o(t)}}function a(t){try{s(r.throw(t))}catch(t){o(t)}}function s(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(u,a)}s((r=r.apply(t,e||[])).next())}))},s=this&&this.__generator||function(t,e){var n,r,i,o,u={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;u;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return u.label++,{value:o[1],done:!1};case 5:u.label++,r=o[1],o=[0];continue;case 7:o=u.ops.pop(),u.trys.pop();continue;default:if(!(i=(i=u.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){u=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){u.label=o[1];break}if(6===o[0]&&u.label<i[1]){u.label=i[1],i=o;break}if(i&&u.label<i[2]){u.label=i[2],u.ops.push(o);break}i[2]&&u.ops.pop(),u.trys.pop();continue}o=e.call(t,u)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}},l=this&&this.__values||function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};r=[n,e,n(1),n(8)],void 0===(i=function(t,e,n,r){"use strict";e.__esModule=!0;var i=function(t){function e(e){var n=t.call(this,document.createElement("div"),"dashboard")||this;return n.model=e,n.addBtn=document.createElement("button"),n.shieldsElm=document.createElement("div"),n.container.appendChild(n.shieldsElm),n.addBtn.innerText="+",n.addBtn.classList.add("add-button"),n.container.appendChild(n.addBtn),n.addBtn.addEventListener("click",(function(){n.model.newShield()})),n.render(),n}return u(e,t),e.prototype.render=function(){return a(this,void 0,void 0,(function(){var t,e,n,i,o,u,a,c,f=this;return s(this,(function(s){switch(s.label){case 0:return this.shieldsElm.innerHTML="",[4,this.model.getShields()];case 1:t=s.sent(),e=function(t){var e=new r.ShieldController(t);e.attach(n.shieldsElm),e.events.add((function(t){switch(t){case"updated":f.model.updateShield(e.shield)}}))},n=this;try{for(i=l(t),o=i.next();!o.done;o=i.next())u=o.value,e(u)}catch(t){a={error:t}}finally{try{o&&!o.done&&(c=i.return)&&c.call(i)}finally{if(a)throw a.error}}return[2]}}))}))},e}(n.AbstractBaseController);e.DashboardController=i}.apply(e,r))||(t.exports=i)},function(t,e,n){var r,i,o,u=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});r=[n,e,n(1),n(2)],void 0===(i=function(t,e,n,r){"use strict";e.__esModule=!0;var i=function(t){function e(e){var n=t.call(this,document.createElement("div"),"shield")||this;return n.shield=e,n.nameInput=document.createElement("input"),n.shieldImg=document.createElement("img"),n.updateBtn=document.createElement("button"),n.events=new r.EventEmitter,n.nameInput.value=e.Name,n.container.appendChild(n.nameInput),n.nameInput.addEventListener("input",(function(){e.Name=n.nameInput.value})),n.shieldImg.src="https://img.local.shielded.dev/s/"+e.ShieldID,n.container.appendChild(n.shieldImg),n.container.appendChild(n.updateBtn),n.updateBtn.addEventListener("click",(function(){n.events.trigger("updated")})),n}return u(e,t),e}(n.AbstractBaseController);function o(t){return"https://img.shielded.dev/s/"+t.ShieldID}e.ShieldController=i,e.ShieldURL=o,e.ShieldMarkdown=function(t){return"!["+t.Name+"]("+o(t)+")"}}.apply(e,r))||(t.exports=i)},function(t,e,n){var r,i,o=this&&this.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function u(t){try{s(r.next(t))}catch(t){o(t)}}function a(t){try{s(r.throw(t))}catch(t){o(t)}}function s(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(u,a)}s((r=r.apply(t,e||[])).next())}))},u=this&&this.__generator||function(t,e){var n,r,i,o,u={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;u;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return u.label++,{value:o[1],done:!1};case 5:u.label++,r=o[1],o=[0];continue;case 7:o=u.ops.pop(),u.trys.pop();continue;default:if(!(i=(i=u.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){u=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){u.label=o[1];break}if(6===o[0]&&u.label<i[1]){u.label=i[1],i=o;break}if(i&&u.label<i[2]){u.label=i[2],u.ops.push(o);break}i[2]&&u.ops.pop(),u.trys.pop();continue}o=e.call(t,u)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}},a=this&&this.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),u=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)u.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return u},s=this&&this.__spread||function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(a(arguments[e]));return t},l=this&&this.__values||function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};r=[n,e,n(2)],void 0===(i=function(t,e,n){"use strict";e.__esModule=!0;var r=function(){function t(t){this.shieldsApi=t,this.shieldEventEmitter=new n.EventEmitter,this.shields=[],this.timeouts={}}return t.prototype.getShields=function(){return o(this,void 0,void 0,(function(){var t;return u(this,(function(e){switch(e.label){case 0:return this.shields.length<1?(t=this,[4,this.shieldsApi.getShields()]):[3,2];case 1:t.shields=e.sent(),e.label=2;case 2:return[2,this.shields]}}))}))},t.prototype.updateShield=function(t,e){var n=this;void 0===e&&(e=2e3);var r=t.ShieldID;if(!r)throw Error("Attempting to update unpersisted note");var i=!1;if(this.shields.map((function(e){return e.ShieldID==r?(i=!0,t):e})),!i)throw Error("Failed to update note");return this.timeouts[r]&&clearTimeout(this.timeouts[r].timeout),this.shieldEventEmitter.trigger({shield:t,event:"changed"}),new Promise((function(i){var a=[i];n.timeouts[r]&&(a=s(n.timeouts[r].resolves,a)),n.timeouts[r]={timeout:setTimeout((function(){return o(n,void 0,void 0,(function(){var e,n,i,o;return u(this,(function(u){switch(u.label){case 0:return this.shieldEventEmitter.trigger({shield:t,event:"updating"}),[4,this.shieldsApi.saveShield(t)];case 1:u.sent(),this.shieldEventEmitter.trigger({shield:t,event:"updated"});try{for(e=l(this.timeouts[r].resolves),n=e.next();!n.done;n=e.next())(0,n.value)()}catch(t){i={error:t}}finally{try{n&&!n.done&&(o=e.return)&&o.call(e)}finally{if(i)throw i.error}}return this.timeouts[r].resolves=[],[2]}}))}))}),e),resolves:a}}))},t.prototype.newShield=function(){return o(this,void 0,void 0,(function(){var t;return u(this,(function(e){switch(e.label){case 0:return[4,this.shieldsApi.saveShield({Name:"New Shield",Title:"New",Text:"Shield"})];case 1:return t=e.sent(),this.shields.push(t),this.shieldEventEmitter.trigger({shield:t,event:"created"}),[2,t]}}))}))},t}();e.ShieldsModel=r}.apply(e,r))||(t.exports=i)}])}));